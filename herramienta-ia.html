<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Claridad IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #0c1427; /* Fondo del iframe */
            color: #fbf5e2;
        }
        /* Estilos para el contenedor de la respuesta y el spinner */
        #response-container {
            display: none; /* Oculto por defecto */
            scroll-margin-top: 2rem; /* Añade un margen superior al hacer scroll */
        }
        /* Spinner magenta (semicírculo) */
        .spinner {
            width: 56px;
            height: 56px;
            display: none; /* Oculto por defecto */
            border: 6px solid #fbf5e2;
            border-bottom-color: #e91e63; /* Color magenta */
            border-radius: 50%;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-3xl mx-auto">
        <div class="bg-gray-900/50 p-6 rounded-lg border border-gray-700">
            <h1 class="text-2xl font-bold mb-4 text-cyan-300">Asistente de Claridad</h1>
            <p class="text-gray-400 mb-6">Describe tu situación o pregunta para recibir una reflexión basada en los principios del curso.</p>

            <div class="space-y-6">
                <div>
                    <label for="user-prompt" class="block text-sm font-medium text-gray-300 mb-2">Tu consulta:</label>
                    <textarea id="user-prompt" rows="4" class="w-full bg-gray-800 border border-gray-600 rounded-md p-3 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none" placeholder="Ej: Siento ansiedad cuando pienso en el futuro..."></textarea>
                </div>

                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="generate-response-btn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-300">
                        Generar Reflexión
                    </button>
                    <button id="generate-sentence-btn" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-300">
                        Crear Oración Sanadora
                    </button>
                </div>
            </div>
        </div>

        <div id="response-container" class="mt-8 bg-gray-900/50 p-6 rounded-lg border border-gray-700">
            
            <div id="loading-spinner" class="spinner mx-auto"></div>

            <div id="ai-response" class="text-white prose prose-invert max-w-none"></div>

        </div>
        </div>

    <script>
        // --- Referencias a los elementos del DOM ---
        const generateResponseBtn = document.getElementById('generate-response-btn');
        const generateSentenceBtn = document.getElementById('generate-sentence-btn');
        
        const responseContainer = document.getElementById('response-container');
        const loadingSpinner = document.getElementById('loading-spinner');
        const aiResponseOutput = document.getElementById('ai-response');
        const userInput = document.getElementById('user-prompt');

        // --- Función principal que maneja la generación ---
        async function handleGeneration(promptType) {
            // 1. Desactivar botones y limpiar la respuesta anterior
            generateResponseBtn.disabled = true;
            generateSentenceBtn.disabled = true;
            generateResponseBtn.classList.add('opacity-50', 'cursor-not-allowed');
            generateSentenceBtn.classList.add('opacity-50', 'cursor-not-allowed');
            aiResponseOutput.innerHTML = '';

            // 2. Mostrar el contenedor de respuesta y el spinner
            responseContainer.style.display = 'block';
            loadingSpinner.style.display = 'block';

            // 3. HACER SCROLL AUTOMÁTICO a la zona de respuesta
            responseContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // --- Simulación de llamada a la API ---
            // En una implementación real, aquí iría tu fetch a '/.netlify/functions/get-ai-response'
            try {
                // Simulamos una espera de 3 segundos
                await new Promise(resolve => setTimeout(resolve, 3000)); 
                
                // Texto de ejemplo según el botón pulsado
                const responseText = promptType === 'reflexion'
                    ? 'Esta es una reflexión profunda sobre tu consulta. La clave está en observar tus pensamientos sin juzgarlos, permitiendo que pasen como nubes en el cielo. La paz no se encuentra en la ausencia de problemas, sino en la capacidad de lidiar con ellos.'
                    : 'Aquí tienes una oración sanadora para ti: "Libero la necesidad de controlar el futuro y confío en que tengo la fortaleza para afrontar cualquier cosa que venga. Elijo la paz en este momento presente."';

                // 4. Mostrar la respuesta y ocultar el spinner
                aiResponseOutput.innerHTML = `<p>${responseText}</p>`;

            } catch (error) {
                console.error('Error al generar la respuesta:', error);
                aiResponseOutput.innerHTML = `<p class="text-red-400">Lo siento, ha ocurrido un error. Por favor, inténtalo de nuevo más tarde.</p>`;
            } finally {
                // 5. Ocultar el spinner y reactivar los botones
                loadingSpinner.style.display = 'none';
                generateResponseBtn.disabled = false;
                generateSentenceBtn.disabled = false;
                generateResponseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                generateSentenceBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // --- Añadir los listeners a los botones ---
        generateResponseBtn.addEventListener('click', () => {
            handleGeneration('reflexion');
        });

        generateSentenceBtn.addEventListener('click', () => {
            handleGeneration('sanadora');
});
    </script>
</body>
</html>
